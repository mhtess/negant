---
title: "Analysis for Expt. 2"
output: github_document
---


```{r libraries}
library(tidyverse)
library(tidyboot)
library(ggthemes)
library(ggpirate)
library(langcog)
library(knitr)
library(lme4)
library(lmerTest)
library(ggstance)
library(ggridges)
library(viridis)
theme_set(theme_few())

project.prefix.1slider.morph<- "7_1slider_morph"
project.prefix.1slider.lex <- "7_1slider_lex"
project.prefix.4slider.morph <- "8_4slider_morph"
project.prefix.4slider.lex <- "8_4slider_lex"
#fig.path <- "~/Documents/talks/laangcog-0219/figs/"
fig.path <- "~/projects/negant/writing/journal/figs/"
loadData <- function(project.prefix){
  read.csv(paste("../../../data/",project.prefix,
        "/",project.prefix,"-trials.csv", 
        sep = ""))
}

loadTime <-  function(project.prefix){
  read.csv(paste("../../../data/", project.prefix,
                 "/",project.prefix,"-time.csv", 
                 sep = ""))
}

loadSubjComments <- function(project.prefix){
    read.csv(paste("../../../data/", project.prefix,
                   "/",project.prefix,
                 "-subject_information.csv", sep = "")) %>%
    mutate(age = as.numeric(as.character(age)))
}

orange.purple.color.palette <- 
  c("#e66101", "#b2abd2", "#fdb863", "#5e3c99")
```

## Load data

```{r loadData, eval = F, echo = F}
d.1s.morph <- loadData("7_1slider_morph") %>%
  mutate(condition = 'implicit')
d.1s.lex <- loadData("7_1slider_lex") %>%
  mutate(workerid = workerid + 1 + max(d.1s.morph$workerid),
         condition = 'implicit')
d.4s.morph <- loadData("8_4slider_morph") %>%
  mutate(workerid = workerid + 1 + max(d.1s.lex$workerid),
         condition = 'explicit')
d.4s.lex <- loadData("8_4slider_lex") %>%
  mutate(workerid = workerid + 1 + max(d.4s.morph$workerid),
         condition = 'explicit')

d.full <- bind_rows(d.1s.morph, d.1s.lex, d.4s.morph, d.4s.lex) %>%
  mutate(antonym_type = factor(antonym_type),
         condition = factor(condition),
         adjective = factor(adjective))

d.1s.morph.subj <- loadSubjComments("7_1slider_morph") %>%
  mutate(condition = 'implicit')
d.1s.lex.subj <- loadSubjComments("7_1slider_lex") %>%
  mutate(workerid = workerid + 1 + max(d.1s.morph.subj$workerid),
         condition = 'implicit')
d.4s.morph.subj <- loadSubjComments("8_4slider_morph") %>%
  mutate(workerid = workerid + 1 + max(d.1s.lex.subj$workerid),
         condition = 'explicit')
d.4s.lex.subj <- loadSubjComments("8_4slider_lex") %>%
  mutate(workerid = workerid + 1 + max(d.4s.morph.subj$workerid),
         condition = 'explicit')

d.full.comments <- bind_rows(d.1s.morph.subj, d.1s.lex.subj, d.4s.morph.subj, d.4s.lex.subj)


# write_csv(d.full, "../data/expt2/expt2-trials.csv")
# write_csv(d.full.comments, "../data/expt2/expt2-subject_information.csv")
```

```{r load data}
d.full <- read_csv("../data/expt2/expt2-trials.csv")
d.full.comments <- read_csv("../data/expt2/expt2-subject_information.csv")
```

##### Self-reported native language

```{r selfReportEnglishNative}
d.full.nativeEnglish <- d.full.comments %>% 
  select(workerid ,language) %>% 
  mutate(englishNative = grepl("eng", tolower(language)))

#save(d.full.nativeEnglish, file = "../cached_results/english_summary.RData")

table(d.full.nativeEnglish$englishNative)

# what do people report for native english that is not english?
d.full.nativeEnglish %>%
  filter(!englishNative) %>%
  select(language) %>%
  kable(.)
```



#### Normalize ratings (by subject, subject off mean and divide by SD)

Also recode antonyms (in dataframe, morph antonyms and lexical antonyms are coded as two different types). Here, we recode them to be the same level of a factor (but with different levels of a differnt factor: antonym_type)

```{r normalizedRatingsForViz}
d.full.natEng <- left_join(
    d.full, 
    d.full.nativeEnglish
  ) %>%
    filter(englishNative) %>%  #Remove participants who do not self-report English as native language
    group_by(workerid) %>%
    mutate(meanRating = mean(response), sdRating = sd(response)) %>%
    ungroup() %>%
  rowwise() %>%
    mutate(normalizedResponse = (response - meanRating) / sdRating) %>%
  mutate(
    adjective_type = as.character(adjective_type),
    #Code antonyms (morpholoigical & lexical) as antonyms (rather than two distinct categories)
    adjective_type_rescaled = ifelse( 
           adjective_type %in% c("lexant", "morphant"), "antonym", 
           ifelse( 
             adjective_type %in% c("neg_lexant", "neg_morphant"), "neg_antonym",
             adjective_type)
           ),
     adjective_type_rescaled = factor(adjective_type_rescaled,
                                 levels = c("antonym",
                                            "neg_positive",
                                            "neg_antonym",
                                            "positive")),
    antonym_type = factor(antonym_type, levels = c("morphant", "lexant")),
    condition = factor(condition, levels = c("implicit", "explicit")),
    item = ifelse(antonym_type == "lexant",
                 paste(lexant, "--", positive, sep = ""),
                 paste(morphant, "--", positive, sep = "")),
   antonym = ifelse(antonym_type == "lexant", 
                    as.character(lexant), 
                    as.character(morphant))
  ) %>%
  group_by(workerid, antonym_type, adjective_type) %>%
  arrange(trial_num) %>%
  mutate(presentation_num = ave(adjective_type==adjective_type, 
                                adjective_type, FUN=cumsum)) %>%
  ungroup() %>%
  rowwise() %>%
  mutate(splitHalf = ifelse(trial_num <= 8, "first", "second"))

## check that i've done the filtering correctly
length(unique(d.full.natEng$workerid))

write_csv(d.full.natEng, "../data/expt2/expt2-filtered.csv")
```

# Plots


```{r fig_densities}

d.full.boot.pres <- d.full.natEng %>%
  #filter(condition == "implicit") %>%
  mutate(adjective_type_rescaled = factor(adjective_type_rescaled, 
                           levels = c("antonym",
                                      "neg_positive",
                                      "neg_antonym", 
                                      "positive"),
                           labels = c("Antonym",
                                      "Negated positive",
                                      "Negated antonym",
                                      "Positive"))) %>%
  group_by(condition, antonym_type, adjective_type_rescaled) %>%
  #group_by(antonym_type, adjective_type, splitHalf) %>%
  multi_boot_standard(col = "response") %>%
  ungroup() %>%
  mutate(
    antonym_type = factor(antonym_type, levels = c("morphant", "lexant"), c("morphological", "lexical")),
    condition = factor(condition, levels = c("implicit", "explicit"), labels = c("single\nutterance", "multiple\nutterances"))
    )


d.full.natEng %>%
   mutate(adjective_type_rescaled = factor(adjective_type_rescaled,
                           levels =c("antonym",
                                      "neg_positive",
                                      "neg_antonym",
                                     "positive"),
                           labels = c("Antonym",
                                      "Negated positive",
                                      "Negated antonym", 
                                      "Positive")),
           antonym_type = factor(antonym_type, levels = c("morphant", "lexant"), c("morphological", "lexical")),
          condition = factor(condition, levels = c("implicit", "explicit"), labels = c("single\nutterance", "multiple\nutterances"))) %>%
ggplot(., aes( x = response, y = adjective_type_rescaled, fill = ..x..))+
  geom_vline(xintercept = 0.5, linetype = "dashed", alpha = 0.5)+
  geom_density_ridges_gradient(
    jittered_points = T,  scale = 0.85,
    #position = position_points_jitter(width = 0.01, height = 0),
    #point_shape = '|', point_size = 2.5, point_alpha = 0.3,
    rel_min_height = 0.01, gradient_lwd = 1,
    stat = 'binline', bins = 25, draw_baseline = T
  ) +
  geom_linerangeh(data = d.full.boot.pres,
    inherit.aes = F,
    aes(xmin = ci_lower, xmax = ci_upper, 
        y = as.numeric(adjective_type_rescaled) +0.15),
    size = 1.5, color = 'white')+
  geom_point(data = d.full.boot.pres,
    inherit.aes = F,
    aes(x = mean,
        y = as.numeric(adjective_type_rescaled)+0.15),
    size = 2, color = 'white', shape = 3)+
  facet_grid(condition~antonym_type)+
  scale_fill_viridis(option = "E")+
  #scale_color_viridis(option = "C", limits = c(0, 1))+
  guides(fill = F, color = F)+
  ylab("")+
  scale_x_continuous(limits = c(0, 1), breaks = c(0, 1),
                     expand = c(0.01, 0))+
  scale_y_discrete(expand = expand_scale(mult = c(0.05, .30)))+
  xlab("slider ratings")+
  theme(strip.text.y = element_text(angle = 0))



# 

# ggsave(paste(fig.path,
#              "expt2_ridges_wCIs_hist.pdf", sep = ""),
#        width = 8, height = 5)
```

# Regression models: Standardized units

Technique: Helmert coding, maximal model, and model comparison to simpler model.

#### Hypothesis 1: When alternatives are implicit, morphological antonyms ("unhappy") do not show difference from negated positives ("not happy"), while lexical antonyms ("sad") do.


```{r}
d.full.natEng %>%
  ungroup() %>%
  summarize( m = mean(normalizedResponse),
             stdev = sd(normalizedResponse))
```


```{r regression1}
# Helmert coding to compare Negated Positive with Antonym
# 
# d.full.natEng.rescaled <- within(d.full.natEng, {
#   adj_type <- C(adjective_type_rescaled, helmert, 3)
#   print(attributes(adj_type))
# }) %>% select(-item) %>% rename(item = positive) %>%
#   mutate(
#     antonym_type = factor(antonym_type, levels = c( "morphant", "lexant"))
#     )

my.forward.diff = matrix(c(
  3/4, -1/4, -1/4, -1/4, 
  1/2, 1/2, -1/2, -1/2, 
  1/4, 1/4, 1/4, -3/4), 
  ncol = 3)

#assigning the forward difference coding to adjective_type
d.full.natEng.rescaled <- d.full.natEng %>% select(-item) %>% 
  rename(item = positive,
         adj_type = adjective_type_rescaled) %>% 
  mutate(
    antonym_type = factor(antonym_type, levels = c( "morphant", "lexant"))
    )

contrasts(d.full.natEng.rescaled$adj_type) = my.forward.diff

contrasts(d.full.natEng.rescaled$adj_type)

# maximal model (adding "+ antonym_type" by item fails to converge)
rs1.helmert.norm.implicit <- lmer(normalizedResponse ~ antonym_type * adj_type + 
                       (1 | workerid) + 
                       (1 | item),
                     data = d.full.natEng.rescaled %>% filter(condition == "implicit"))

rs1.helmert.implicit.norm.summary <- summary(rs1.helmert.norm.implicit)

#load("../cached_results/regression_antTypeXadjType_implicitCond.RData")
# save(rs1.helmert.implicit.summary, file =
#        "../cached_results/regression_antTypeXadjType_implicitCond.RData")
rs1.implicit.norm.coef <- rs1.helmert.implicit.norm.summary[["coefficients"]]

data.frame(rs1.implicit.norm.coef) %>%
  mutate(Rowname = row.names(.)) %>%
  write_csv(., path = '../../journal/csv_data_4_tex/expt2_norm_glmer_singleUtt.csv')
```

does the maximal model account for significantly more variance than simpler models?

```{r}
rs1.helmert.implicit.norm.complex<- lmer(normalizedResponse ~ antonym_type * adj_type + 
                       (0 + adj_type | workerid) + 
                       (1 | item),
                     data = d.full.natEng.rescaled %>% filter(condition == "implicit"))

rs1.helmert.implicit.norm.complex.noItem <- lmer(normalizedResponse ~ antonym_type * adj_type + 
                       (0 + adj_type | workerid),
                     data = d.full.natEng.rescaled %>% filter(condition == "implicit"))


tt <- getME(rs1.helmert.implicit.norm.complex,"theta")
ll <- getME(rs1.helmert.implicit.norm.complex,"lower")
min(tt[ll==0])


rs1.helmert.implicit.norm.complex2 <- lmer(normalizedResponse ~ antonym_type * adj_type + 
                       (0 + antonym_type | workerid) + 
                       (1 | item),
                     data = d.full.natEng.rescaled %>% filter(condition == "implicit"))

rs1.helmert.implicit.norm.complex3 <- lmer(normalizedResponse ~ antonym_type * adj_type + 
                       (0 + antonym_type | workerid) + 
                       (1 + adj_type || item),
                     data = d.full.natEng.rescaled %>% filter(condition == "implicit"))

rs1.helmert.implicit.norm.complex4 <- lmer(normalizedResponse ~ antonym_type * adj_type + 
                       (0 + antonym_type || workerid) + 
                       (1 + adj_type || item),
                     data = d.full.natEng.rescaled %>% filter(condition == "implicit"))

rs1.helmert.implicit.norm.complex5 <- lmer(normalizedResponse ~ antonym_type * adj_type + 
                       (0 + antonym_type + adj_type || workerid) + 
                       (1 + adj_type + antonym_type || item),
                     data = d.full.natEng.rescaled %>% filter(condition == "implicit"))




anova(rs1.helmert.implicit.norm.complex, rs1.helmert.implicit.norm.complex5)
# extra random effect of adjective_type by item accounts for significantly more variance

## model with alternative random effects structure fails to converge
# rs1.helmert.implicit.simpler2 <- lmer(response ~ antonym_type * adj_type + 
#                        (1 | workerid) + 
#                        (1 + adj_type | item),
#                      data = d.full.natEng %>% filter(condition == "implicit"))
```

recoded with Lexant as the base case

```{r}
#assigning the forward difference coding to adjective_type
d.full.natEng.rescaled <- d.full.natEng %>% select(-item) %>% 
  rename(item = positive,
         adj_type = adjective_type_rescaled) %>% 
  mutate(
    antonym_type = factor(antonym_type, levels = c("lexant", "morphant"))
    )

contrasts(d.full.natEng.rescaled$adj_type) = my.forward.diff

contrasts(d.full.natEng.rescaled$adj_type)

# maximal model (adding "+ antonym_type" by item fails to converge)
rs1.helmert.implicit2.norm <- lmer(normalizedResponse ~ antonym_type * adj_type + 
                       (0 + adj_type || workerid) + 
                       (1 |item),
                     data = d.full.natEng.rescaled %>% 
                       filter(condition == "implicit"))

rs2.helmert.implicit.norm.summary <- summary(rs1.helmert.implicit2.norm)

#load("../cached_results/regression_antTypeXadjType_implicitCond.RData")
# save(rs1.helmert.implicit.summary, file =
#        "../cached_results/regression_antTypeXadjType_implicitCond.RData")
rs2.implicit.norm.coef <- rs2.helmert.implicit.norm.summary[["coefficients"]]

data.frame(rs2.implicit.norm.coef) %>%
  mutate(Rowname = row.names(.)) %>%
  write_csv(., path = '../../journal/csv_data_4_tex/expt2_norm_lmer_singleUtt_lexBase.csv')
```


#### Hypothesis 2: Within morphological antonyms ("unhappy"), is there a difference between antonyms ("unhappy") and negated positives ("not happy") when alternatives are implicit vs. explicit?

```{r regression2}
d.full.natEng.rescaled <- d.full.natEng.rescaled %>%
  mutate(condition = factor(condition, levels = c("explicit", "implicit")))

## testing for interaction within morphological
rs2.helmert.norm.morph <- lmer(
  normalizedResponse ~ condition * adj_type + 
           (0 + adj_type | workerid) + 
           (1  | item),
         data = d.full.natEng.rescaled %>% filter(antonym_type == "morphant")
)

rs2.helmert.norm.morph.summary <- summary(rs2.helmert.norm.morph)
#save(rs2.helmert.morph.summary, file =
       #"../cached_results/regression_adjTypeXcontext_morph.RData")


summary(rs2.helmert.norm.morph.summary)

rs2.norm.morph.coef <- rs2.helmert.norm.morph.summary[["coefficients"]]
rs2.norm.morph.coef


rs2.norm.morph.coef %>%
  data.frame(.) %>%
  mutate(Rowname = row.names(.)) %>%
  write_csv(., path = '../../journal/csv_data_4_tex/expt2_norm_lmer_morphological.csv')

```

does the maximal model account for significantly more variance than simpler models?

```{r}
rs2.helmert.morph.simpler1 <- lmer(normalizedResponse ~ condition * adj_type + 
                       (1 | workerid) + 
                       (1 | item),
          data = d.full.natEng.rescaled %>% filter(antonym_type == "morphant")
)




anova(rs2.helmert.morph.simpler1, rs2.helmert.morph)
# extra random effect of adjective_type by item accounts for significantly more variance
```


## Secondary analyses

### 3-way interaction

```{r regression_3ways}

rs.helmert.3way <- lmer(
  normalizedResponse ~ adj_type   * antonym_type * condition + 
           (0 + adj_type || workerid) + 
           (1 + condition || item),
         data = d.full.natEng.rescaled
)

rs.helmert.3way.2 <- lmer(
  normalizedResponse ~ adj_type   * antonym_type * condition + 
           (0 + adj_type || workerid) + 
           (0 + antonym_type || item),
         data = d.full.natEng.rescaled
)

rs.helmert.3way.3 <- lmer(
  normalizedResponse ~ adj_type   * antonym_type * condition + 
           (0 + adj_type || workerid) + 
           (1 | item),
         data = d.full.natEng.rescaled
)


# rs.helmert.3way.3 <- lmer(
#   normalizedResponse ~ adj_type   * antonym_type * condition + 
#            (0 + adj_type || workerid) + 
#            (1 + antonym_type || item),
#          data = d.full.natEng.rescaled
# )
# 
# 
# 
# rs.helmert.3way.4 <- lmer(
#   normalizedResponse ~ -1 + adj_type * antonym_type * condition + 
#            (1 + adj_type | workerid) + 
#            (1 + adj_type | item),
#          data = d.full.natEng.rescaled
# )
# 
# rs.helmert.3way.4a <- lmer(
#   normalizedResponse ~ adj_type * antonym_type * condition + 
#            (1 + adj_type | workerid) + 
#            (1 + condition | item),
#          data = d.full.natEng.rescaled
# )
# 
# rs.helmert.3way.4b <- lmer(
#   normalizedResponse ~ adj_type * antonym_type * condition + 
#            (1 + adj_type | workerid) + 
#            (1 + antonym_type | item),
#          data = d.full.natEng.rescaled
# )
# 
# rs.helmert.3way.5 <- lmer(
#   normalizedResponse ~ adj_type * antonym_type * condition + 
#            (1 + adj_type | workerid) + 
#            (1 + adj_type + condition | item),
#          data = d.full.natEng.rescaled
# )
# 
# rs.helmert.3way.6 <- lmer(
#   normalizedResponse ~ adj_type * antonym_type * condition + 
#            (1 + adj_type | workerid) + 
#            (1 + adj_type + condition + antonym_type | item),
#          data = d.full.natEng.rescaled
# )

# no difference
anova(rs.helmert.3way.2, rs.helmert.3way)

# no difference
anova(rs.helmert.3way.3, rs.helmert.3way)

anova(rs.helmert.3way.5, rs.helmert.3way.4)
# 3way.5 not significantly better than 3way.4
anova(rs.helmert.3way.4, rs.helmert.3way.3)
# 3way.4 significantly better than 3way.3

summary(rs.helmert.3way.4)
summary(rs.helmert.3way.4a)
summary(rs.helmert.3way.4b)

rs3.3way.norm.summary <- summary(rs.helmert.3way)
#save(rs3.3way.summary, file =
#       "../cached_results/regression_antTypeXadjTypeXcontext.RData")
rs3.3way.norm.coef <- rs3.3way.norm.summary[["coefficients"]]


rs3.3way.norm.coef %>%
  data.frame(.) %>%
  mutate(Rowname = row.names(.)) %>%
  write_csv(., path = '../../journal/csv_data_4_tex/expt2_norm_glmer_full3way.csv')
```

```{r regression_3wayTests}
# maximal model
## (adding +st by item fails to converge)

rs.5.helmert.0 <- lmer(response ~ antonym_type * adj_type +
                       (1 | workerid) +
                       (1 | item),
                     data = d.full.natEng)

# extra random effect of sentence_type by participant accounts for significantly more variance
anova(rs.5.helmert.0, rs.5.helmert.3)

summary(rs.5.helmert.3)
```

###  Simple effects

Testing for "simple effects"

```{r reg.simple.morph.implicit}
rs1.helmert.implicit.simple.morph <- lmer(response ~ adj_type + 
                       (1 + adj_type | workerid) + 
                       (1 + adj_type | item),
                     data = d.full.natEng %>%
                       filter(antonym_type == "morphant",
                              condition == "implicit")
                     )

rs1.simple.morph.implicit.summary <- summary(rs1.helmert.implicit.simple.morph)

#save(rs1.simple.morph.implicit.summary, file =
#       "../cached_results/regression_simple_adjType_morph_implicit.RData")

rs1.implicit.simple.morph.coef <- rs1.simple.morph.implicit.summary[["coefficients"]]
data.frame(rs1.implicit.simple.morph.coef) %>%
  mutate(Rowname = row.names(.)) %>%
  write_csv(., path = 'csv_data_4_tex/expt2_glmer_singleUtt_morphological.csv')

rs1.simple.morph.implicit.summary
```

```{r reg.simple.lex.implicit}
rs1.helmert.implicit.simple.lex <- lmer(response ~ adj_type + 
                       (1 + adj_type | workerid) + 
                       (1  | item),
                     data = d.full.natEng %>%
                       filter(antonym_type == "lexant",
                              condition == "implicit")
                     )

rs1.simple.lex.implicit.summary <- summary(rs1.helmert.implicit.simple.lex)

#save(rs1.simple.lex.implicit.summary, file =
       #"../cached_results/regression_simple_adjType_lex_implicit.RData")

rs1.implicit.simple.lex.coef <- rs1.simple.lex.implicit.summary[["coefficients"]]

rs1.implicit.simple.lex.coef %>%
  data.frame(.) %>%
  mutate(Rowname = row.names(.)) %>%
  write_csv(., path = 'csv_data_4_tex/expt2_glmer_singleUtt_lexical.csv')

rs1.simple.lex.implicit.summary
```

```{r reg.simple.morph.explicit}

rs.5.helmert.0.simple <- lmer(response ~ adj_type + 
                       (1 + adj_type | workerid) + 
                       (1 | item),
                     data = d.full.natEng %>% 
                       filter(antonym_type == "morphant")
                     )

summary(rs.5.helmert.0.simple)
```

```{r reg.simple.lex.explicit}
rs.5.helmert.0.simple.lex <- lmer(response ~ adj_type + 
                       (1 + adj_type | workerid) + 
                       (1 + adj_type | item),
                     data = d.full.natEng %>% 
                       filter(antonym_type == "lexant")
                     )

summary(rs.4.helmert.0.simple.lex)
```


```{r}
rs.5.morph.simple.implicit.negant <- lmer(response ~ 1 + 
                       (1  | workerid) + 
                       (1  | positive),
                     data = d.full.natEng %>%
                       filter(antonym_type == "morphant", adjective_type == "neg_morphant", 
                              condition == "implicit") %>%
                       mutate(response = response - 0.5)
                     )

summary(rs.5.morph.simple.implicit.negant)
```

```{r}
rs.5.morph.simple.explicit.negant <- lmer(response ~ 1 + 
                       (1  | workerid) + 
                       (1  | positive),
                     data = d.full.natEng %>%
                       filter(antonym_type == "morphant", adjective_type == "neg_morphant", 
                              condition == "explicit") %>%
                       mutate(response = response - 0.5)
                     )

summary(rs.5.morph.simple.explicit.negant)
```


# Regression models

Technique: Helmert coding, maximal model, and model comparison to simpler model.

#### Hypothesis 1: When alternatives are implicit, morphological antonyms ("unhappy") do not show difference from negated positives ("not happy"), while lexical antonyms ("sad") do.

```{r regression1}
# Helmert coding to compare Negated Positive with Antonym
# 
# d.full.natEng.rescaled <- within(d.full.natEng, {
#   adj_type <- C(adjective_type_rescaled, helmert, 3)
#   print(attributes(adj_type))
# }) %>% select(-item) %>% rename(item = positive) %>%
#   mutate(
#     antonym_type = factor(antonym_type, levels = c( "morphant", "lexant"))
#     )

my.forward.diff = matrix(c(
  3/4, -1/4, -1/4, -1/4, 
  1/2, 1/2, -1/2, -1/2, 
  1/4, 1/4, 1/4, -3/4), 
  ncol = 3)

#assigning the forward difference coding to adjective_type
d.full.natEng.rescaled <- d.full.natEng %>% select(-item) %>% 
  rename(item = positive,
         adj_type = adjective_type_rescaled) %>% 
  mutate(
    antonym_type = factor(antonym_type, levels = c( "morphant", "lexant"))
    )

contrasts(d.full.natEng.rescaled$adj_type) = my.forward.diff

contrasts(d.full.natEng.rescaled$adj_type)

# maximal model (adding "+ antonym_type" by item fails to converge)
rs1.helmert.implicit <- lmer(response ~ antonym_type * adj_type + 
                       (1 | workerid) + 
                       (1 | item),
                       #REML = FALSE, 
                      #control = lmerControl(optimizer ="Nelder_Mead"),
                     data = d.full.natEng.rescaled %>% filter(condition == "implicit"))

rs1.helmert.implicit.summary <- summary(rs1.helmert.implicit)

#load("../cached_results/regression_antTypeXadjType_implicitCond.RData")
# save(rs1.helmert.implicit.summary, file =
#        "../cached_results/regression_antTypeXadjType_implicitCond.RData")
rs1.implicit.coef <- rs1.helmert.implicit.summary[["coefficients"]]

data.frame(rs1.implicit.coef) %>%
  mutate(Rowname = row.names(.)) %>%
  write_csv(., path = '../../journal/csv_data_4_tex/expt2_glmer_singleUtt.csv')
```

does the maximal model account for significantly more variance than simpler models?

```{r}
rs1.helmert.implicit.simpler1 <- lmer(response ~ antonym_type * adj_type + 
                       (1 + adj_type | workerid) + 
                       (1 | item),
                     data = d.full.natEng.rescaled %>% filter(condition == "implicit"))

anova(rs1.helmert.implicit.simpler1, rs1.helmert.implicit)
# extra random effect of adjective_type by item accounts for significantly more variance

## model with alternative random effects structure fails to converge
# rs1.helmert.implicit.simpler2 <- lmer(response ~ antonym_type * adj_type + 
#                        (1 | workerid) + 
#                        (1 + adj_type | item),
#                      data = d.full.natEng %>% filter(condition == "implicit"))
```

recoded with Lexant as the base case

```{r}
#assigning the forward difference coding to adjective_type
d.full.natEng.rescaled <- d.full.natEng %>% select(-item) %>% 
  rename(item = positive,
         adj_type = adjective_type_rescaled) %>% 
  mutate(
    antonym_type = factor(antonym_type, levels = c("lexant", "morphant"))
    )

contrasts(d.full.natEng.rescaled$adj_type) = my.forward.diff

contrasts(d.full.natEng.rescaled$adj_type)

# maximal model (adding "+ antonym_type" by item fails to converge)
rs1.helmert.implicit2 <- lmer(response ~ antonym_type * adj_type + 
                       (1 + adj_type | workerid) + 
                       (1 + adj_type | item),
                     data = d.full.natEng.rescaled %>% 
                       filter(condition == "implicit"))

rs2.helmert.implicit.summary <- summary(rs1.helmert.implicit2)

#load("../cached_results/regression_antTypeXadjType_implicitCond.RData")
# save(rs1.helmert.implicit.summary, file =
#        "../cached_results/regression_antTypeXadjType_implicitCond.RData")
rs2.implicit.coef <- rs2.helmert.implicit.summary[["coefficients"]]
data.frame(rs2.implicit.coef) %>%
  mutate(Rowname = row.names(.)) %>%
  write_csv(., path = '../../journal/csv_data_4_tex/expt2_glmer_singleUtt_lexBase.csv')
```


#### Hypothesis 2: Within morphological antonyms ("unhappy"), is there a difference between antonyms ("unhappy") and negated positives ("not happy") when alternatives are implicit vs. explicit?

```{r regression2}
d.full.natEng.rescaled <- d.full.natEng.rescaled %>%
  mutate(condition = factor(condition, levels = c("explicit", "implicit")))
## testing for interaction within morphological
rs2.helmert.morph <- lmer(
  response ~ condition * adj_type + 
           (1  | workerid) + 
           (1 + adj_type | item),
         data = d.full.natEng.rescaled %>% filter(antonym_type == "morphant")
)

rs2.helmert.morph.summary <- summary(rs2.helmert.morph)
#save(rs2.helmert.morph.summary, file =
       #"../cached_results/regression_adjTypeXcontext_morph.RData")


summary(rs2.helmert.morph)

rs2.morph.coef <- rs2.helmert.morph.summary[["coefficients"]]
rs2.morph.coef


rs2.morph.coef %>%
  data.frame(.) %>%
  mutate(Rowname = row.names(.)) %>%
  write_csv(., path = '../../journal/csv_data_4_tex/expt2_glmer_morphological.csv')

```

does the maximal model account for significantly more variance than simpler models?

```{r}
rs2.helmert.morph.simpler1 <- lmer(response ~ condition * adj_type + 
                       (1 | workerid) + 
                       (1 | item),
          data = d.full.natEng.rescaled %>% filter(antonym_type == "morphant")
)




anova(rs2.helmert.morph.simpler1, rs2.helmert.morph)
# extra random effect of adjective_type by item accounts for significantly more variance
```


## Secondary analyses

### 3-way interaction

```{r regression_3ways}

rs.helmert.3way <- lmer(
  response ~ adj_type * antonym_type * condition + 
           (1 | workerid) + 
           (1 + condition | item),
         data = d.full.natEng
)

rs.helmert.3way.2 <- lmer(
  response ~ adj_type * antonym_type * condition + 
           (1 | workerid) + 
           (1 + antonym_type | item),
         data = d.full.natEng
)


rs.helmert.3way.3 <- lmer(
  response ~ adj_type * antonym_type * condition + 
           (1 | workerid) + 
           (1 + adj_type | item),
         data = d.full.natEng
)

rs.helmert.3way.4 <- lmer(
  response ~ -1 + adj_type * antonym_type * condition + 
           (1 + adj_type | workerid) + 
           (1 + adj_type | item),
         data = d.full.natEng
)

rs.helmert.3way.4a <- lmer(
  response ~ adj_type * antonym_type * condition + 
           (1 + adj_type | workerid) + 
           (1 + condition | item),
         data = d.full.natEng
)

rs.helmert.3way.4b <- lmer(
  response ~ adj_type * antonym_type * condition + 
           (1 + adj_type | workerid) + 
           (1 + antonym_type | item),
         data = d.full.natEng
)

rs.helmert.3way.5 <- lmer(
  response ~ adj_type * antonym_type * condition + 
           (1 + adj_type | workerid) + 
           (1 + adj_type + condition | item),
         data = d.full.natEng
)

rs.helmert.3way.6 <- lmer(
  response ~ adj_type * antonym_type * condition + 
           (1 + adj_type | workerid) + 
           (1 + adj_type + condition + antonym_type | item),
         data = d.full.natEng
)

anova(rs.helmert.3way.6, rs.helmert.3way.5)
# not significantly better than 3way.5
anova(rs.helmert.3way.6, rs.helmert.3way.4)
# not significantly better than 3way.4
anova(rs.helmert.3way.5, rs.helmert.3way.4)
# 3way.5 not significantly better than 3way.4
anova(rs.helmert.3way.4, rs.helmert.3way.3)
# 3way.4 significantly better than 3way.3

summary(rs.helmert.3way.4)
summary(rs.helmert.3way.4a)
summary(rs.helmert.3way.4b)

rs3.3way.summary <- summary(rs.helmert.3way.4)
#save(rs3.3way.summary, file =
#       "../cached_results/regression_antTypeXadjTypeXcontext.RData")
rs3.3way.coef <- rs3.3way.summary[["coefficients"]]


rs3.3way.coef%>%
  data.frame(.) %>%
  mutate(Rowname = row.names(.)) %>%
  write_csv(., path = 'csv_data_4_tex/expt2_glmer_full3way.csv')
```

```{r regression_3wayTests}
# maximal model
## (adding +st by item fails to converge)

rs.5.helmert.0 <- lmer(response ~ antonym_type * adj_type +
                       (1 | workerid) +
                       (1 | item),
                     data = d.full.natEng)

# extra random effect of sentence_type by participant accounts for significantly more variance
anova(rs.5.helmert.0, rs.5.helmert.3)

summary(rs.5.helmert.3)
```

###  Simple effects

Testing for "simple effects"

```{r reg.simple.morph.implicit}
rs1.helmert.implicit.simple.morph <- lmer(response ~ adj_type + 
                       (1 + adj_type | workerid) + 
                       (1 + adj_type | item),
                     data = d.full.natEng %>%
                       filter(antonym_type == "morphant",
                              condition == "implicit")
                     )

rs1.simple.morph.implicit.summary <- summary(rs1.helmert.implicit.simple.morph)

#save(rs1.simple.morph.implicit.summary, file =
#       "../cached_results/regression_simple_adjType_morph_implicit.RData")

rs1.implicit.simple.morph.coef <- rs1.simple.morph.implicit.summary[["coefficients"]]
data.frame(rs1.implicit.simple.morph.coef) %>%
  mutate(Rowname = row.names(.)) %>%
  write_csv(., path = 'csv_data_4_tex/expt2_glmer_singleUtt_morphological.csv')

rs1.simple.morph.implicit.summary
```

```{r reg.simple.lex.implicit}
rs1.helmert.implicit.simple.lex <- lmer(response ~ adj_type + 
                       (1 + adj_type | workerid) + 
                       (1  | item),
                     data = d.full.natEng %>%
                       filter(antonym_type == "lexant",
                              condition == "implicit")
                     )

rs1.simple.lex.implicit.summary <- summary(rs1.helmert.implicit.simple.lex)

#save(rs1.simple.lex.implicit.summary, file =
       #"../cached_results/regression_simple_adjType_lex_implicit.RData")

rs1.implicit.simple.lex.coef <- rs1.simple.lex.implicit.summary[["coefficients"]]

rs1.implicit.simple.lex.coef %>%
  data.frame(.) %>%
  mutate(Rowname = row.names(.)) %>%
  write_csv(., path = 'csv_data_4_tex/expt2_glmer_singleUtt_lexical.csv')

rs1.simple.lex.implicit.summary
```

```{r reg.simple.morph.explicit}

rs.5.helmert.0.simple <- lmer(response ~ adj_type + 
                       (1 + adj_type | workerid) + 
                       (1 | item),
                     data = d.full.natEng %>% 
                       filter(antonym_type == "morphant")
                     )

summary(rs.5.helmert.0.simple)
```

```{r reg.simple.lex.explicit}
rs.5.helmert.0.simple.lex <- lmer(response ~ adj_type + 
                       (1 + adj_type | workerid) + 
                       (1 + adj_type | item),
                     data = d.full.natEng %>% 
                       filter(antonym_type == "lexant")
                     )

summary(rs.4.helmert.0.simple.lex)
```


```{r}
rs.5.morph.simple.implicit.negant <- lmer(response ~ 1 + 
                       (1  | workerid) + 
                       (1  | positive),
                     data = d.full.natEng %>%
                       filter(antonym_type == "morphant", adjective_type == "neg_morphant", 
                              condition == "implicit") %>%
                       mutate(response = response - 0.5)
                     )

summary(rs.5.morph.simple.implicit.negant)
```

```{r}
rs.5.morph.simple.explicit.negant <- lmer(response ~ 1 + 
                       (1  | workerid) + 
                       (1  | positive),
                     data = d.full.natEng %>%
                       filter(antonym_type == "morphant", adjective_type == "neg_morphant", 
                              condition == "explicit") %>%
                       mutate(response = response - 0.5)
                     )

summary(rs.5.morph.simple.explicit.negant)
```

# Other

#### Table of items

```{r itemTable}
d.items <- d.full %>%
  select(positive, lexant, morphant) %>%
  distinct() %>%
  select(positive, morphant, lexant) 

d.items <- d.items[with(d.items, order(positive)),] %>%
  rename("Positive adjective" = positive, "Morphological antonym" = morphant,
         "Lexical antonym" = lexant)

tab1 <- xtable::xtable(d.items, caption = "Items used in Experiment 2.")
#save(tab1, file = "../cached_results/item_table.RData")
# print(tab1, type="latex", comment = F, table.placement = "H",  include.rownames=FALSE)
```

#### Time to complete task

```{r loadTimeToCompleteTask}
d.1s.morph.time <- loadTime("7_1slider_morph") %>%
  mutate(condition = 'implicit')
d.1s.lex.time <- loadTime("7_1slider_lex") %>%
  mutate(workerid = workerid + 1 + max(d.1s.morph.time$workerid),
         condition = 'implicit')
d.4s.morph.time <- loadTime("8_4slider_morph") %>%
  mutate(workerid = workerid + 1 + max(d.1s.lex.time$workerid),
         condition = 'explicit')
d.4s.lex.time <- loadTime("8_4slider_lex") %>%
  mutate(workerid = workerid + 1 + max(d.4s.morph.time$workerid),
         condition = 'explicit')

d.full.time <- bind_rows(d.1s.morph.time, d.1s.lex.time, d.4s.morph.time, d.4s.lex.time)

d.time.summary <- d.full.time %>%
  mutate(condition = factor(condition)) %>%
  group_by(condition) %>%
  summarize(aveTime = mean(time),
            sdTime = sd(time))

#save(d.time.summary, file = "../cached_results/time_summary.RData")

ggplot(d.full.time, aes(x = time)) +
  geom_histogram()+
  facet_wrap(~condition, scales = 'free')+
  xlab("time in minutes")
```

#### Participant comments

```{r loadSubjectComments}
d.full.comments %>% select(comments) %>% filter(comments != "") %>% kable()
```


# Visualize data





```{r}
d.full.natEng %>%
  group_by(workerid, condition, antonym_type, adjective_type_rescaled) %>%
  count() %>%
  group_by(condition, antonym_type, adjective_type_rescaled, n) %>%
  count() %>%
  kable()
```


### Raw histograms


```{r fig_histograms}
d.full.natEng %>%
   mutate(adjective_type_rescaled = factor(adjective_type_rescaled,
                           levels =c("positive",
                                     "antonym",
                                      "neg_positive",
                                      "neg_antonym"),
                           labels = c("Positive","Antonym",
                                      "Negated positive",
                                      "Negated antonym")),
           antonym_type = factor(antonym_type, levels = c("morphant", "lexant"), c("morphological", "lexical")),
          condition = factor(condition, levels = c("implicit", "explicit"), labels = c("single utterance", "multiple utterances"))) %>%
  ggplot(., aes( x = response, fill = adjective_type_rescaled))+
  geom_density(alpha = 0.8, color = 'white')+
  theme_black()+
  facet_grid(antonym_type~condition, scales = 'free')+
  ylab("empirical density")+
  xlab("slider ratings")+
  theme(strip.text.y = element_text(angle = 0),
        legend.position = 'bottom')+
  guides(fill = guide_legend(title = "", reverse = T))+
  scale_x_continuous(limits = c(0, 1), breaks = c(0, 0.5, 1))

# ggsave(paste(fig.path, project.prefix, 
#              "_empiricalDensity_expt2_raw.pdf", sep = ""),
#        width = 7, height = 4)
```



```{r}
d.full.natEng %>%
  mutate(adjective_type_rescaled = factor(adjective_type_rescaled,
                           levels = c("antonym",
                                      "neg_positive",
                                      "neg_antonym", 
                                      "positive"),
                           labels = c("Sad /\n Unhappy",
                                      "Not happy",
                                      "Not sad /\n Not unhappy",
                                      "Happy"))) %>%
ggplot(., aes( x = normalizedResponse, y = adjective_type_rescaled, fill = adjective_type_rescaled))+
  #geom_density(alpha = 0.5)+
  geom_density_ridges(jittered_points = T, alpha = 0.8, scale = 0.8,
                      position = position_points_jitter(width = 0.01, height = 0),
                      point_shape = '|', point_size = 2.5, point_alpha = 0.3,
                      #stat = "binline", bins = 20
                      )+
  facet_wrap(antonym_type~condition, scales = 'free')+
  scale_fill_solarized()+
  guides(fill = F)+
  ylab("")+
  #scale_fill_manual(values = orange.purple.color.palette)+
  scale_x_continuous(limits = c(-2.5, 2.5), expand = c(0.01, 0))+
  scale_y_discrete(expand = c(0.05, 0))+
  xlab("slider ratings")
```


```{r fig_bootstrappedCIs_implicit}

d.full.impl <- d.full.natEng %>%
  #filter(condition == "implicit") %>%
  mutate(adjective_type_rescaled = factor(adjective_type_rescaled, 
                           levels = c("antonym",
                                      "neg_positive",
                                      "neg_antonym", 
                                      "positive"),
                           labels = c("Antonym",
                                      "Negated positive",
                                      "Negated antonym",
                                      "Positive")), 
             antonym_type = factor(antonym_type, levels = c("morphant", "lexant"), c("morphological", "lexical")),
    condition = factor(condition, levels = c("implicit", "explicit"), labels = c("single utterance", "multiple utterances")))

# df.oneSlider.ci <- d.l1.4.boot
# save(df.oneSlider.ci, file = "../cached_results/oneSlider_bootstrappedCIs.RData")


ggplot(d.full.boot.pres,
       aes(x = adjective_type_rescaled)) +
  facet_grid(antonym_type~condition, scales = "free") +
  coord_flip() +
  theme_black()+
  geom_hline(yintercept = 0.5, linetype = "dashed", color = "white") +
  # geom_violin(data = df.l1.resp.pres, colour = "grey",
  #             position = position_dodge(width = 0.75), alpha = 0,
  #             aes(y = response,
  #                 group = interaction(adjective_type, presentation_num))) +
  geom_point(data = d.full.impl, position = position_jitterdodge(jitter.width = 0.75),
             aes(y = response, color = adjective_type_rescaled), alpha = 0.1) +
  geom_linerange(aes(ymin = ci_lower, ymax = ci_upper),
                 position = position_dodge(width = 0.75), size = 3, color = "white") +
  #scale_y_continuous(limits = c(0, 1), breaks = c(0, 0.5, 1)) +
  scale_color_solarized(guide = FALSE) +
  labs(x = "", y = "slider rating")+
    scale_y_continuous(limits = c(0, 1), breaks = c(0, 0.5, 1))+
  theme(strip.text.y = element_text(angle = 0))
# ggsave(paste(
#   "~/projects/negant/analysis/figs/expt2_trials.pdf", sep = ""),
#        width = 7, height = 4.5)

ggsave(paste(fig.path, project.prefix, "_empiricalSummary_expt2_raw.pdf", sep = ""),
       width = 6, height = 3.5)
```


```{r fig_bootstrappedCIs_presNum}
d.full.boot.pres <- d.full.natEng %>%
  #filter(condition == "implicit") %>%
  mutate(adjective_type_rescaled = factor(adjective_type_rescaled, 
                           levels = c("antonym",
                                      "neg_positive",
                                      "neg_antonym", 
                                      "positive"),
                           labels = c("Antonym",
                                      "Negated positive",
                                      "Negated antonym",
                                      "Positive")),
             presentation_num = ifelse(condition == "explicit", ceiling(presentation_num / 4), presentation_num)) %>%
  group_by(condition, antonym_type, adjective_type_rescaled, presentation_num) %>%
  #group_by(antonym_type, adjective_type, splitHalf) %>%
  multi_boot_standard(col = "response") %>%
  ungroup() %>%
  mutate(
    presentation_num = factor(presentation_num, levels = c(3, 2, 1)),
    antonym_type = factor(antonym_type, levels = c("morphant", "lexant"), c("morphological", "lexical")),
    condition = factor(condition, levels = c("implicit", "explicit"), labels = c("single utterance", "multiple utterances"))
    )
d.full.impl <- d.full.natEng %>%
  #filter(condition == "implicit") %>%
  mutate(adjective_type_rescaled = factor(adjective_type_rescaled, 
                           levels = c("antonym",
                                      "neg_positive",
                                      "neg_antonym", 
                                      "positive"),
                           labels = c("Antonym",
                                      "Negated positive",
                                      "Negated antonym",
                                      "Positive")), 
             presentation_num = ifelse(condition == "explicit", ceiling(presentation_num / 4), presentation_num),
                           presentation_num = factor(presentation_num, levels = c(3, 2,1)),
             antonym_type = factor(antonym_type, levels = c("morphant", "lexant"), c("morphological", "lexical")),
    condition = factor(condition, levels = c("implicit", "explicit"), labels = c("single utterance", "multiple utterances")))

# df.oneSlider.ci <- d.l1.4.boot
# save(df.oneSlider.ci, file = "../cached_results/oneSlider_bootstrappedCIs.RData")


ggplot(d.full.boot.pres,
       aes(x = adjective_type_rescaled, group = presentation_num)) +
  facet_grid(antonym_type~condition, scales = "free") +
  coord_flip() +
  theme_black()+
  geom_hline(yintercept = 0.5, linetype = "dashed", color = "white") +
  # geom_violin(data = df.l1.resp.pres, colour = "grey",
  #             position = position_dodge(width = 0.75), alpha = 0,
  #             aes(y = response,
  #                 group = interaction(adjective_type, presentation_num))) +
  geom_point(data = d.full.impl, position = position_jitterdodge(),
             aes(y = response, color = adjective_type_rescaled), alpha = 0.1) +
  geom_linerange(aes(ymin = ci_lower, ymax = ci_upper),
                 position = position_dodge(width = 0.75), size = 3, color = "white") +
  #scale_y_continuous(limits = c(0, 1), breaks = c(0, 0.5, 1)) +
  scale_color_solarized(guide = FALSE) +
  labs(x = "", y = "slider rating")+
    scale_y_continuous(limits = c(0, 1), breaks = c(0, 0.5, 1))+
  theme(strip.text.y = element_text(angle = 0))
# ggsave(paste(
#   "~/projects/negant/analysis/figs/expt2_trials.pdf", sep = ""),
#        width = 7, height = 4.5)

ggsave(paste(fig.path, project.prefix, "_empiricalSummary_byPresNum_expt2_raw.pdf", sep = ""),
       width = 7, height = 4)
```


```{r}
d.l1.8.boot.adj <- d.full.natEng %>%
  mutate(ant_pair = paste(morphant, " / ", lexant, sep = "")) %>%
  mutate(
    antonym_type = as.character(antonym_type),
    lexant = as.character(lexant),
    morphant = as.character(morphant),
    antonym = ifelse(antonym_type == "lexant", lexant, morphant)) %>%
  group_by(condition, positive, antonym, antonym_type, adjective_type_rescaled) %>%
  multi_boot_standard(col = "response") %>%
  ungroup() %>%
  mutate(adjective_type_rescaled = factor(adjective_type_rescaled, 
                           levels = c("antonym",
                                      "neg_positive",
                                      "neg_antonym", 
                                      "positive"),
                           labels = c("Antonym",
                                      "Negated positive",
                                      "Negated antonym",
                                      "Positive")),
                    antonym_type = factor(antonym_type, levels = c("morphant", "lexant"),
                                          labels = c("morphological", "lexical")))
all.items <- unique(d.l1.8.boot.adj$positive)
subset.of.indices <- 11:20
ggplot(d.l1.8.boot.adj %>% filter(positive %in% all.items[subset.of.indices]), 
       aes(x = adjective_type_rescaled)) +
  facet_wrap(~ antonym_type + condition + positive + antonym, nrow = 4) +
  coord_flip() +
  geom_hline(yintercept = 0.5, linetype = "dashed", color = 'grey70') +
  # geom_violin(data = df.l1.resp.pres, colour = "grey",
  #             position = position_dodge(width = 0.75), alpha = 0,
  #             aes(y = response,
  #                 group = interaction(adjective_type, presentation_num))) +
  geom_point(data = d.full.natEng %>% 
               mutate( ant_pair = paste(morphant, " / ", lexant, sep = ""),
                           antonym_type = as.character(antonym_type),
                      lexant = as.character(lexant),
                    morphant = as.character(morphant),
                       antonym = ifelse(antonym_type == "lexant", lexant, morphant),
                    antonym_type = factor(antonym_type, levels = c("morphant", "lexant"),
                                          labels = c("morphological", "lexical")),
                    adjective_type_rescaled = factor(adjective_type_rescaled, 
                           levels = c("antonym",
                                      "neg_positive",
                                      "neg_antonym", 
                                      "positive"),
                           labels = c("Antonym",
                                      "Negated positive",
                                      "Negated antonym",
                                      "Positive"))) %>%
                    filter(positive %in% all.items[subset.of.indices]), position = position_jitterdodge(jitter.width = 0.75),
             aes(y = response, color = adjective_type_rescaled), alpha = 0.5) +
  geom_linerange(aes(ymin = ci_lower, ymax = ci_upper),
                 position = position_dodge(width = 0.75), size = 3, color = 'white') +
  #scale_y_continuous(limits = c(-2.25, 2.25), breaks = c(-2, 0, 2)) +
  scale_y_continuous(limits = c(-0, 1), breaks = c(0, 1)) +
  scale_color_solarized(guide = FALSE) +
  labs(x = "", y = "slider rating") +
  theme_black()
# ggsave(paste(fig.path, project.prefix, "_dotplot_unNorm_diffOrder_item2.pdf", sep = ""),
#        width = 15, height = 10)
```



#### Negated morphological antonyms (single utterance) by item
```{r}

d.negant.impl.morph.n_neg <- d.full.natEng %>%
  filter(condition == "implicit", antonym_type == "morphant",
         adjective_type == "neg_morphant") %>%
  group_by(positive, morphant) %>%
  summarize(n_neg = sum(response < 0.45),
            n = n(),
            p_neg = n_neg / n)

d.full.natEng %>%
  filter(condition == "implicit", antonym_type == "morphant",
         adjective_type == "neg_morphant") %>%
  mutate(morphant = factor(morphant, levels = with(d.negant.impl.morph.n_neg, morphant[order(p_neg)]))) %>%
  ggplot(., aes( x = response, y = morphant))+
  #facet_wrap(~morphant, scales = "free") +
  #coord_flip() +
#  geom_hline(yintercept = 0, linetype = "dashed") +
  geom_vline(xintercept = 0.5, color = 'white') +
  theme_black()+
  geom_density_ridges(jittered_points = T, alpha = 0.8, scale = 1,
                      position = position_points_jitter(width = 0.01, height = 0),
                      point_shape = '|', point_size = 2.5, point_alpha = 0.8,
                      color = 'white'
                      #stat = "binline", bins = 20
                      )+
  #facet_wrap(antonym_type~condition, scales = 'free')+
  scale_fill_solarized()+
  guides(fill = F)+
  ylab("")+
  #scale_fill_manual(values = orange.purple.color.palette)+
  #scale_x_continuous(limits = c(-2.5, 2.5), expand = c(0.01, 0))+
  scale_x_continuous(limits = c(0, 1),
                     breaks = c(0, 0.5, 1),
                     expand = c(0.01, 0))+
  scale_y_discrete(expand = c(0.05, 0))+
  xlab("slider ratings")


#ggsave(paste("~/Documents/talks/langcog-0219/figs/itemWise_negant.pdf", sep = ""), width = 6, height = 7)

  # geom_point( position = position_jitterdodge(),
  #            aes(y = normalizedResponse, color = adjective_type_rescaled), alpha = 0.7) +
  # # geom_violin(colour = "grey",
  # #             position = position_dodge(width = 0.75), alpha = 0,
  # #             aes(y = normalizedResponse,
  # #                 group = interaction(adjective_type, morphant))) +
  # scale_color_solarized(guide = FALSE) +
  # labs(x = "", y = "normalized rating")
# geom_histogram(position = position_dodge(), bins = 25)+
  # facet_wrap(~morphant)+
  # scale_fill_manual(values = orange.purple.color.palette)+
  # ylab("counts")+
  # xlab("slider ratings")+
  # #guides(fill = F)+
  # theme(strip.text.y = element_text(angle = 0),
  #       legend.position = 'bottom')+
  # scale_x_continuous(limits = c(-2, 2), breaks = c(-1, 0, 1))



```

counts from web 1t

```{r}
web1t.freq <- data.frame(
  uninteresting = 301612,
  interesting = 46985123,
  intelligent = 14136953,
  unintelligent = 92517,
  patriotic = 3654140, 
  unpatriotic = 187764,
  polite = 2171712,
  impolite = 178417,
  kind = 70424712 ,
  unkind = 244143,
  honest = 11109403,
  dishonest = 936098,
  generous = 5698368,
  ungenerous = 23554,
  affectionate = 718575,
  unaffectionate = 2799,
  rational = 6946351,
  irrational = 1336826,
  ambitious = 3292680,
  unambitious = 24606,
  happy = 63507173,
  unhappy = 2737752,
  mature = 73898047,
  immature = 1277806,
  educated = 5649174,
  uneducated = 372987,
  friendly = 64542810,
  unfriendly = 493833,
  tolerant = 2148989,
  intolerant = 568083,
  sincere = 2477241,
  insincere = 160122,
  forgiving = 744920,
  unforgiving =241008 ,
  resourceful = 509538,
  unresourceful =1214 ,
  reliable = 20351804,
  unreliable = 1372148,
  attractive = 11857523,
  unattractive =399316
)


d.negant.impl.morph.n_neg.freq <- bind_rows(
  d.negant.impl.morph.n_neg %>%
  select(positive, morphant) %>%
  rename(morphant1 = positive,
         positive = morphant) %>%
  rename(morphant = morphant1),
    d.negant.impl.morph.n_neg %>%
  select(positive, morphant) 
) %>%
  left_join(., web1t.freq %>% 
  gather(positive, positive_freq)) %>% 
  left_join(., 
            bind_rows(
  d.negant.impl.morph.n_neg %>%
  select(positive, morphant) %>%
  rename(morphant1 = positive,
         positive = morphant) %>%
  rename(morphant = morphant1),
    d.negant.impl.morph.n_neg %>%
  select(positive, morphant) 
) %>%
  left_join(., web1t.freq %>% 
  gather(morphant, morphant_freq))) %>%
  unique() %>%
  filter(positive %in% d.negant.impl.morph.n_neg$positive) %>%
  left_join(., d.negant.impl.morph.n_neg)
  


d.negant.impl.morph.n_neg.freq <- d.negant.impl.morph.n_neg.freq %>%
  mutate(
    #logpos_logant = log(morphant_freq - positive_freq)
    logpos_logant = log(morphant_freq/positive_freq) 
  )


d.negant.impl.morph.n_neg.freq %>%
  ggplot(., aes( x = logpos_logant, y = p_neg, label = morphant))+
  geom_point()+
  geom_smooth()+
  geom_label()

with(d.negant.impl.morph.n_neg.freq, cor(logpos_logant, p_neg))
```


```{r}
library(ngram)
adjectives <- d.full.natEng %>%
  distinct(positive, morphant)  %>%
  mutate(adjs = paste(positive, " ", morphant, sep = "")) %>%
  pull(adjs)
adjectives
#print(ng, output = "full")
```

Proportion of "productive" responses

```{r}
d.full.negant.productive <- d.full.natEng %>%
  filter(condition == "implicit", antonym_type == "morphant",
         adjective_type == "neg_morphant") %>%
  mutate(belowZero = normalizedResponse < 0) %>%
  group_by(morphant) %>%
  tidyboot_mean(column = belowZero)

d.full.negant.productive.rt <- d.full.natEng %>%
  filter(condition == "implicit", antonym_type == "morphant",
         adjective_type == "neg_morphant") %>%
  mutate(belowZero = normalizedResponse < 0,
         logrt = log(rt)) %>%
  group_by(belowZero) %>%
  tidyboot_mean(column = logrt)

d.full.negant.productive.rt %>%
  ggplot(., aes( x = belowZero, y = mean, ymin = ci_lower, ymax = ci_upper))+
  geom_linerange()+
  geom_point()
```
```{r}
d.full.natEng %>%
  filter(condition == "implicit", antonym_type == "morphant",
         adjective_type == "neg_morphant") %>%
  mutate(belowZero = normalizedResponse < 0,
         logrt = log(rt)) %>%
  ggplot(., aes( x = logrt))+
  geom_histogram()+
  facet_wrap(~belowZero)
```

### Bootstrapped CIs

```{r boostrapCIs, fig.height=2, fig.width=7}
d.full.boot <- d.full.natEng %>%
  group_by(condition, antonym_type, adjective_type_rescaled) %>%
  multi_boot_standard(col = "normalizedResponse") 

#df.fourSlider.ci <- d.l1.5.boot
#save(d.full.boot, file = "../cached_results/bootstrappedCIs.RData")

d.full.boot %>%
  ungroup() %>%
  mutate(antonym_type = factor(antonym_type, levels = c( "lexant", "morphant"))) %>%
  ggplot(., aes(
    x = condition,
    y = mean,
     ymin = ci_lower, 
    ymax = ci_upper,
    color = adjective_type_rescaled,
    group = antonym_type
              ))+
  xlab("")+
  coord_flip()+
    geom_linerange(position = position_jitterdodge(dodge.width = 0.75,
                                    jitter.height = 0,
                                    jitter.width = 0.2),
                   size = 5)+
  scale_color_manual(name="Adjective type",
                    values = orange.purple.color.palette,
                    guide = guide_legend(reverse=TRUE))+
    scale_fill_manual(name="Adjective type",
                    values = orange.purple.color.palette,
                    guide = guide_legend(reverse=TRUE))+
  ylab("mean normalized rating")+
  scale_y_continuous(limits = c(-1.1,1.4), breaks = c(-1, 0, 1))

# ggsave(paste(
#   "~/Documents/research/negant/analysis/figs/1d_bootstrapped.pdf", sep = ""),
#        width = 8, height = 2.5)
```

#### Exploratory: various by-item plots

```{r explore_byItem}

d.full.boot.item <- d.full.natEng %>%
  group_by(condition, antonym_type, antonym, positive, adjective_type_rescaled) %>%
  multi_boot_standard(col = "normalizedResponse")# %>%
  #   ungroup() %>%
  # mutate(antonym_type = factor(antonym_type, 
  #                          levels = c("lexical", "morphological")))
d.full.boot.item.wide <- left_join(
  d.full.boot.item %>%
    filter(antonym_type == "morphant") %>% 
    rename(m_mean = mean, m_lower = ci_lower, m_upper = ci_upper) %>%
    ungroup() %>%
    select(-antonym_type),
  d.full.boot.item %>%
    filter(antonym_type == "lexant") %>% 
    rename(l_mean = mean, l_lower = ci_lower, l_upper = ci_upper, negative = antonym) %>%
    ungroup() %>%
    select(-antonym_type)
)

ggplot(d.full.boot.item.wide, 
       aes(x = m_mean, y = l_mean, xmin = m_lower, ymin = l_lower, xmax = m_upper, ymax = l_upper,
           color = adjective_type_rescaled))+
  geom_abline(intercept = 0, slope = 1, alpha = 0.3)+
  geom_point()+geom_errorbar(alpha = 0.3)+geom_errorbarh(alpha = 0.3)+
  facet_wrap(~condition, scales = 'fixed')+
  scale_x_continuous(limits = c(-1.3, 1.5))+
  scale_y_continuous(limits = c(-1.3, 1.5))+
  coord_fixed(ratio = 1)

d.full.boot.item.wide %>%
  mutate(lm_diff = abs(m_mean) - abs(l_mean)) %>%
  ggplot(., aes( x = lm_diff, fill = adjective_type_rescaled))+
  xlab("absolute difference of Morph - Lexical")+
  #geom_density( alpha = 0.3 )+
  #facet_wrap(~condition)
  geom_histogram()+
  geom_vline(xintercept = 0, lty = 2)+
  facet_grid(adjective_type_rescaled~ condition )
``` 

#### Exploratory: by item facets of bootstrapped CIs

```{r explore_byItem95CIs}
d.full.natEng %>% filter(condition == "explicit", antonym_type == "morphant") %>%
     mutate(adjective_type_rescaled = factor(adjective_type_rescaled,
                           levels =c("antonym",
                                      "neg_positive",
                                      "neg_antonym",
                                     "positive"),
                           labels = c("Antonym",
                                      "Negated positive",
                                      "Negated antonym", 
                                      "Positive")),
            pos_ant = paste(antonym, " -- ", positive, "  ", sep = "")) %>%
ggplot(., aes( x = response, y = adjective_type_rescaled, fill = ..x..))+
  geom_vline(xintercept = 0.5, linetype = "dashed", alpha = 0.5)+
  geom_density_ridges_gradient(
    jittered_points = T, alpha = 0.8, scale = 0.7,
    position = position_points_jitter(width = 0.01, height = 0),
    point_shape = '|', point_size = 2.5, point_alpha = 0.4,
    rel_min_height = 0.01, gradient_lwd = 1,
        quantile_lines= T, quantiles = 2
    )+
  # geom_linerangeh(data = d.full.boot.item %>% filter(condition == "implicit", antonym_type == "morphant"),
  #   inherit.aes = F,
  #   aes(xmin = ci_lower, xmax = ci_upper, y = adjective_type_rescaled),
  #   size = 1.25, color = 'white')+
  facet_wrap(~pos_ant)+
  scale_fill_viridis(option = "C")+
  #scale_color_viridis(option = "C", limits = c(0, 1))+
  guides(fill = F, color = F)+
  ylab("")+
  scale_x_continuous(limits = c(0, 1), breaks = c(0, 1),
                     expand = c(0.01, 0))+
  scale_y_discrete(expand = expand_scale(mult = c(0.05, .30)))+
  xlab("slider ratings")+
  theme(strip.text.y = element_text(angle = 0))
# 



ggsave(paste(
  "~/projects/negant/writing/journal/figs/cogsci_expt2_morph_multiUtt_byItem_densities.pdf", sep = ""),
       width = 12, height = 8)

ggsave(paste(
  "~/projects/negant/analysis/figs/cogsci_expt3_byItem_densities.pdf", sep = ""),
       width = 12, height = 8)
```

```{r explore_byItem95CIs}
d.full.boot.item %>% filter(condition == "implicit") %>%
  ggplot(., aes(x = antonym, 
                fill = adjective_type_rescaled, 
              group = adjective_type_rescaled,
                y = mean, ymin = ci_lower, ymax = ci_upper))+
  #geom_hline(yintercept = 0.5, lty = 3)+
  geom_col(position = position_dodge(0.8), width = 0.8, color = 'black')+
  geom_linerange(position = position_dodge(0.8), size = 1)+
  # geom_jitter(data =d.full.natEng, inherit.aes = F,
  #             aes( x = antonym, color = adjective_type_rescaled, 
  #                  group = adjective_type_rescaled,
  #                  y = normalizedResponse), position = position_jitterdodge(dodge.width = .8, jitter.width = 0.2), alpha = 0.5)+
  #geom_pirate(violins = F, bars = F)+
  scale_fill_manual(name="Adjective type",
                    values = orange.purple.color.palette,
                    guide = guide_legend(reverse=F))+
    scale_color_manual(name="Adjective type",
                    values = orange.purple.color.palette,
                    guide = guide_legend(reverse=F))+
  #geom_line(color = 'black')+
    #geom_line(inherit.aes = F, aes(group = interaction(adjective_type_rescaled, antonym)))+
  # geom_errorbar(position = position_dodge(0.8), color = 'black',
  #               width = 0.3)+
  facet_wrap(~positive, scales = 'free', nrow = 2) + 
  #coord_flip()+
  #guides(fill = F)+
  xlab("")+
  #coord_flip()+
  ylab("mean normalized rating")+
  scale_y_continuous(limits = c(-1.5,1.5), breaks = c(-1, 0, 1))+
  theme(axis.text.x = 
        element_text(angle = 45, hjust = 1, vjust = 1),
        legend.position = 'bottom')



ggsave(paste(
  "~/projects/negant/analysis/figs/cogsci_expt3_byItem.pdf", sep = ""),
       width = 12, height = 8)
```


## Bayesian regression models (not used)


```{r}
rs.brm.implicit <- brm(response ~  adj_type * antonym_type + 
                       (1 + adj_type | workerid) + 
                       (1 + adj_type + antonym_type | item),
    data = d.full.natEng %>% filter(condition == "implicit"),
    iter = 2000, warmup = 1000, chains = 3, cores = 3)

summary(rs.brm.implicit)
```

```{r}
rs.brm.implicit.pres <- brm(response ~  presentation_num*antonym_type + 
                       (1 + presentation_num | workerid) + 
                       (1 + presentation_num | item),
    data = d.full.natEng %>% filter(condition == "explicit", 
                                    adj_type == "neg_antonym"),
    iter = 2000, warmup = 1000, chains = 3, cores = 3)

summary(rs.brm.implicit.pres)
```

```{r}
d.full.natEng %>% filter(condition == "implicit", antonym_type == "lexant",
                                    adj_type == "neg_antonym") %>%
  ggplot(.,aes (x = response))+
  geom_histogram()+
  facet_grid(presentation_num~.)

d.full.natEng %>% filter(condition == "implicit", antonym_type == "lexant",
                                    adj_type == "neg_antonym")  %>%
  group_by(presentation_num) %>%
  summarize(mean(response))
```


```{r}
rs.brm.full3way <- brm(response ~  adj_type * antonym_type * condition + 
                       (1 + adj_type | workerid) + 
                       (1 + adj_type + antonym_type | item),
    data = d.full.natEng,
    iter = 2000, warmup = 1000, nchains = 3, cores = 3)


```

